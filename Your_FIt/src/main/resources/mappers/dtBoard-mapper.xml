<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dtBoardMapper">
	<resultMap type="DtBoard" id="resultDtBoard">
		<id property="dt_No" column="dt_No"/>
		<result property="dt_Title" column="dt_Title"/>
		<result property="dt_Content" column="DT_CONTENT"/>
		<collection property="files" ofType="BoardFile" column="F_DTNO">
			<id property="f_No" column="f_No"/>
			<result property="f_Cname" column="F_CNAME" />
		</collection>
	</resultMap>
	
	<select id="selectBoardList" resultMap="resultDtBoard">
		SELECT *
		FROM DT_BOARD B 
		JOIN BOARD_FILE BF 
		ON(B.DT_NO = BF.F_DTNO) 
		WHERE B.STATUS = 'Y'
		ORDER BY B.DT_NO
	</select>
	<select id="selectBoardTotalContents" resultType="_int">
		SELECT COUNT(*) FROM DT_BOARD
	</select>

	<insert id="insertBoard" parameterType="DtBoard">
		INSERT INTO DT_BOARD (DT_NO, DT_TYPE, DT_TITLE, DT_CONTENT, DT_COUNT, DT_MNO, STATUS)
		VALUES('DT'||DT_BOARD_SEQ.NEXTVAL, #{dt_Type}, #{dt_Title}, #{dt_Content}, 0, #{dt_Mno}, 'Y')
	</insert>
	
	<insert id="insertBoardFile" parameterType="BoardFile">
		
		<selectKey keyProperty="dt_No" resultType="string" order="BEFORE">
			SELECT DT_BOARD_SEQ.CURRVAL FROM DUAL
		</selectKey>
		
		INSERT INTO BOARD_FILE(F_NO, F_DTNO, F_TYPE, F_NAME, F_CNAME, F_UPLOADDATE)
		VALUES(BOARD_FILE_SEQ.NEXTVAL, 'DT'||#{dt_No}, '1', #{f_Name}, #{f_Cname}, SYSDATE)
	</insert>
	
	<select id="selectOneBoard" resultMap="resultDtBoard">
		SELECT * FROM DT_BOARD B
		JOIN BOARD_FILE BF
		ON(B.DT_NO = BF.F_DTNO)
		WHERE B.DT_NO = #{dt_No}
	</select>
	
	<select id="selectBoardFileList" resultType="BoardFile">
		SELECT * FROM BOARD_FILE WHERE F_DTNO = #{f_Dtno}
	</select>

	<update id="updateReadCount" parameterType="string">
		UPDATE DT_BOARD
		SET DT_COUNT = DT_COUNT + 1
		WHERE DT_NO = #{dt_No}
	</update>
	
	<update id="updateBoard" parameterType="DtBoard">
		UPDATE DT_BOARD
		SET DT_TITLE = #{dt_Title},
		    DT_CONTENT = #{dt_Content}
		WHERE DT_NO = #{dt_No}
	</update>
	
	<insert id="updateBoardFile" parameterType="BoardFile">
		INSERT INTO BOARD_FILE(F_NO, F_DTNO, F_TYPE, F_NAME, F_CNAME, F_UPLOADDATE) VALUES
		(BOARD_FILE_SEQ.NEXTVAL, #{f_Dtno}, '1', #{f_Name}, #{f_Cname},
		 SYSDATE )
	</insert>
	
	<delete id="deleteBoardFile" parameterType="string">
		DELETE FROM Board_File
		WHERE F_DTNO = #{dt_No}
	</delete>
	
	<delete id="deleteBoard" parameterType="string">
		DELETE FROM DT_BOARD
		WHERE DT_NO = #{dt_No}
	</delete>
	
	<delete id="deleteFile" parameterType="_int">
		DELETE FROM Board_File
		WHERE F_NO = #{fNo}
	</delete>
	
</mapper>










